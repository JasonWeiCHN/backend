<h2>上传游戏配置文件</h2>

<div class="form-container">
  <label>
    选择文件：
    <input type="file" (change)="onFileSelected($event)" />
  </label>

  <ng-container *ngIf="data">
    <!-- tab header -->
    <div class="tab-header">
      <button
        [class.active]="activeTab === 'category'"
        (click)="activeTab = 'category'"
      >
        分类管理
      </button>
      <button
        [class.active]="activeTab === 'game'"
        (click)="activeTab = 'game'"
      >
        游戏编辑
      </button>
    </div>

    <div *ngIf="activeTab === 'category'">
      <h3>分类</h3>
      <div class="category-list">
        <div
          *ngFor="let category of data.categories; let i = index"
          class="category-item"
        >
          <input [(ngModel)]="data.categories[i]" />
          <span class="delete-btn" (click)="removeCategory(i)">×</span>
        </div>
        <button (click)="addCategory()">添加分类</button>
      </div>
    </div>

    <div *ngIf="activeTab === 'game'">
      <h3>游戏列表</h3>

      <div class="search-game">
        <input [(ngModel)]="gameSearch" placeholder="搜索游戏（支持关键字）" />
        <button (click)="searchGame()">搜索</button>
      </div>

      <!-- 只渲染 selectedGame -->
      <div *ngIf="selectedGame" class="game-card">
        <label>游戏名：<input [(ngModel)]="selectedGame.name" /></label>
        <label>封面图：<input [(ngModel)]="selectedGame.image" /></label>

        <label>视频地址列表：</label>
        <div
          *ngFor="let vid of selectedGame.videos; let vi = index"
          class="swiper-item"
        >
          <input [(ngModel)]="selectedGame.videos[vi]" />
          <button (click)="removeVideo(vi)">删除</button>
        </div>
        <button (click)="addVideo()">添加视频</button>

        <label
          >关键字：<input [(ngModel)]="selectedGame.searchKeywords"
        /></label>
        <label>跳转链接：<input [(ngModel)]="selectedGame.path" /></label>
        <label
          >发布日期：<input type="date" [(ngModel)]="selectedGame.releaseDate"
        /></label>
        <label>描述：</label>
        <textarea
          [(ngModel)]="selectedGame.description"
          rows="3"
          style="width: 100%"
        ></textarea>

        <h4>详情图</h4>
        <div
          *ngFor="let img of selectedGame.imagesForDetail; let ii = index"
          class="swiper-item"
        >
          <input [(ngModel)]="selectedGame.imagesForDetail[ii]" />
          <button (click)="removeImage(selectedGame, ii)">删除</button>
        </div>
        <button (click)="addImage(selectedGame)">添加详情图</button>

        <h4>标签</h4>
        <div
          *ngFor="let tag of selectedGame.tags; let ti = index"
          class="swiper-item"
        >
          <input [(ngModel)]="selectedGame.tags[ti]" />
          <button (click)="removeTag(selectedGame, ti)">删除</button>
        </div>
        <button (click)="addTag(selectedGame)">添加标签</button>

        <h4>类型</h4>
        <div
          *ngFor="let genre of selectedGame.genres; let gi = index"
          class="genre-item"
        >
          <label>ID：<input [(ngModel)]="genre.id" /></label>
          <label>名称：<input [(ngModel)]="genre.name" /></label>
          <label>描述：<input [(ngModel)]="genre.description" /></label>
          <button (click)="removeGenre(selectedGame, gi)">删除类型</button>
        </div>
        <button (click)="addGenre(selectedGame)">添加类型</button>

        <h4>攻略</h4>
        <div
          *ngFor="let guide of selectedGame.guides; let gui = index"
          class="genre-item"
        >
          <label>标题：<input [(ngModel)]="guide.title" /></label>
          <label>描述：<input [(ngModel)]="guide.description" /></label>
          <label>作者：<input [(ngModel)]="guide.author" /></label>
          <label>链接：<input [(ngModel)]="guide.sourceUrl" /></label>
          <button (click)="removeGuide(selectedGame, gui)">删除攻略</button>
        </div>
        <button (click)="addGuide(selectedGame)">添加攻略</button>

        <button
          (click)="deleteSelectedGame()"
          style="background-color: #dc3545"
        >
          删除此游戏
        </button>
      </div>

      <button (click)="addGame()">添加新游戏</button>
    </div>
    
    <hr />
    <button (click)="download()">下载为 games.js</button>
  </ng-container>
</div>
