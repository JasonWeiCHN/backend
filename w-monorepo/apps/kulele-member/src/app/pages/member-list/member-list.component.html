<div class="member-list">
  <div class="top-bar">
    <button class="add-button" [routerLink]="['/member/new']">
      â• æ–°å¢ä¼šå‘˜
    </button>

    <!-- âœ… æ–°å¢å¯¼å‡ºæŒ‰é’®ï¼ˆå…¨éƒ¨å¯¼å‡º + æ ¼å¼é€‰æ‹©ï¼‰ -->
    <button class="export-button" (click)="openExportModal()">
      ğŸ“¥ å¯¼å‡ºä¼šå‘˜
    </button>

    <div class="search-bar">
      <input
        [(ngModel)]="searchKeyword"
        (keydown.enter)="search()"
        placeholder="æœç´¢å§“åã€è”ç³»æ–¹å¼æˆ–å¤‡æ³¨"
      />
      <button (click)="search()">ğŸ” æœç´¢</button>
    </div>
  </div>

  <!-- æ¡Œé¢ç«¯è¡¨æ ¼ -->
  <table class="record-table">
    <thead>
      <tr>
        <th>ç¼–å·</th>
        <th>åŠ å…¥æ—¶é—´</th>
        <th>å§“å</th>
        <th>ç”µè¯</th>
        <th>ä½™é¢</th>
        <th>å¤‡æ³¨</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let record of pagedMembers">
        <td>{{ record.id }}</td>
        <td>{{ formatDate(record.createdAt) }}</td>
        <td>{{ record.name }}</td>
        <td>{{ record.phone }}</td>
        <td>{{ record.balance | currency : '' : '' : '1.2-2' }}</td>
        <td>{{ record.remark }}</td>
        <td>
          <button [routerLink]="['/member/details', record.id]">æŸ¥è¯¢</button>
          <button [routerLink]="['/member/edit', record.id]">ç¼–è¾‘</button>
          <button [routerLink]="['/member/recharge', record.id]">å……å€¼</button>
          <button [routerLink]="['/member/consumption', record.id]">
            æ¶ˆè´¹
          </button>
          <button (click)="delete(record.id)">åˆ é™¤</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ç§»åŠ¨ç«¯å¡ç‰‡è§†å›¾ -->
  <div class="record-cards">
    <div class="record-card" *ngFor="let record of pagedMembers">
      <div><strong>ç¼–å·ï¼š</strong>{{ record.id }}</div>
      <div><strong>åŠ å…¥æ—¶é—´ï¼š</strong>{{ formatDate(record.createdAt) }}</div>
      <div><strong>å§“åï¼š</strong>{{ record.name }}</div>
      <div><strong>ç”µè¯ï¼š</strong>{{ record.phone }}</div>
      <div>
        <strong>ä½™é¢ï¼š</strong
        >{{ record.balance | currency : '' : '' : '1.2-2' }}
      </div>
      <div><strong>å¤‡æ³¨ï¼š</strong>{{ record.remark }}</div>
      <div class="card-actions">
        <td>
          <button [routerLink]="['/member/details', record.id]">æŸ¥è¯¢</button>
          <button [routerLink]="['/member/edit', record.id]">ç¼–è¾‘</button>
          <button [routerLink]="['/member/recharge', record.id]">å……å€¼</button>
          <button [routerLink]="['/member/consumption', record.id]">
            æ¶ˆè´¹
          </button>
          <button (click)="delete(record.id)">åˆ é™¤</button>
        </td>
      </div>
    </div>
  </div>

  <!-- åˆ†é¡µ -->
  <div class="pagination">
    <button (click)="prevPage()" [disabled]="currentPage === 1">ä¸Šä¸€é¡µ</button>
    <span>ç¬¬ {{ currentPage }} é¡µ / å…± {{ totalPages }} é¡µ</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">
      ä¸‹ä¸€é¡µ
    </button>
    <span class="total-count">å…± {{ members.length }} ä½ä¼šå‘˜</span>
  </div>

  <div class="export-modal" *ngIf="showExportModal">
    <div class="export-wrapper">
      <div class="export-card">
        <h3>å¯¼å‡ºä¼šå‘˜</h3>

        <p style="margin-bottom: 8px">å¯¼å‡ºèŒƒå›´ï¼š<strong>å…¨éƒ¨ä¼šå‘˜</strong></p>

        <p>
          å¯¼å‡ºæ ¼å¼ï¼š
          <label>
            <input
              type="radio"
              name="exportFormat"
              [(ngModel)]="exportFormat"
              value="txt"
            />
            TXT
          </label>
          <label style="margin-left: 16px">
            <input
              type="radio"
              name="exportFormat"
              [(ngModel)]="exportFormat"
              value="excel"
            />
            Excel
          </label>
          <label style="margin-left: 16px">
            <input
              type="radio"
              name="exportFormat"
              [(ngModel)]="exportFormat"
              value="pdf"
            />
            PDF
          </label>
          <label style="margin-left: 16px">
            <input
              type="radio"
              name="exportFormat"
              [(ngModel)]="exportFormat"
              value="csv"
            />
            CSV
          </label>
        </p>

        <div class="buttons">
          <button (click)="closeExportModal()">å–æ¶ˆ</button>
          <button (click)="downloadExport()">å¯¼å‡º</button>
        </div>
      </div>
    </div>
  </div>
</div>
