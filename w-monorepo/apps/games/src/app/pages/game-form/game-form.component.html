<div class="game-form" *ngIf="form">
  <h2>{{ isEditMode ? '编辑' : '新增' }}游戏</h2>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <label>游戏名：<input formControlName="name" /></label>
    <label>封面图地址：<input formControlName="image" /></label>
    <!-- 分类（多选下拉） -->
    <label>分类：</label>
    <app-multi-select
      [options]="allTags"
      [selectedItems]="form.get('tags')?.value || []"
      (selectedItemsChange)="form.get('tags')?.setValue($event)"
    ></app-multi-select>
    <label>搜索词：<input formControlName="searchKeywords" /></label>
    <label>源路径（可选）：<input formControlName="path" /></label>
    <label>发布日期：<input type="date" formControlName="releaseDate" /></label>

    <div class="section-title">视频地址列表</div>
    <div class="form-section">
      <div formArrayName="videos">
        <div
          *ngFor="let videoCtrl of videos.controls; let i = index"
          class="array-item"
        >
          <input [formControlName]="i" placeholder="视频链接" />
          <button type="button" (click)="removeVideo(i)">删除</button>
        </div>
        <button
          *ngIf="videos.controls.length <= 4"
          type="button"
          (click)="addVideo()"
        >
          + 添加视频
        </button>
      </div>
    </div>

    <div class="section-title">详情图地址列表</div>
    <div class="form-section">
      <div formArrayName="imagesForDetail">
        <div
          *ngFor="let imgCtrl of imagesForDetail.controls; let i = index"
          class="array-item"
        >
          <input [formControlName]="i" placeholder="图片链接" />
          <button type="button" (click)="removeImage(i)">删除</button>
        </div>
        <button
          *ngIf="imagesForDetail.controls.length <= 4"
          type="button"
          (click)="addImage()"
        >
          + 添加图片
        </button>
      </div>
    </div>

    <label>描述：<textarea formControlName="description"></textarea></label>

    <h3>类型 ID 列表（英文逗号分隔）</h3>
    <!-- 类型 -->
    <label>类型：</label>
    <app-multi-select
      [options]="allGenres"
      [selectedItems]="form.get('genres')?.value || []"
      (selectedItemsChange)="form.get('genres')?.setValue($event)"
    ></app-multi-select>

    <div class="actions">
      <button type="submit" [disabled]="form.invalid">
        {{ isEditMode ? '保存修改' : '提交' }}
      </button>
      <button type="button" (click)="router.navigate(['/games'])">取消</button>
    </div>
  </form>
</div>
