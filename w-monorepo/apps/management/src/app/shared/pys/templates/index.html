<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scrape and Save</title>
</head>
<body>
<h1>Scrape and Save</h1>
<form id="saveForm">
  <label for="url">Enter URL:</label><br>
  <input style="width: 800px" type="text" id="url" name="url"><br><br>

  <label for="tags">Select Tags:</label><br>
  <input type="checkbox" id="all" name="tags" value="all">
  <label for="all">All</label><br>
  <input type="checkbox" id="clansDescription" name="tags" value="clansDescription">
  <label for="clansDescription">Clans Description</label><br>
  <input type="checkbox" id="liveRecording" name="tags" value="liveRecording">
  <label for="liveRecording">Live Recording</label><br>
  <input type="checkbox" id="newerTeach" name="tags" value="newerTeach">
  <label for="newerTeach">Newer Teach</label><br>
  <input type="checkbox" id="clip" name="tags" value="clip">
  <label for="clip">Clip</label><br>
  <input type="checkbox" id="story" name="tags" value="story">
  <label for="story">Story</label><br>
  <input type="checkbox" id="task" name="tags" value="task">
  <label for="task">Task</label><br>
  <input type="checkbox" id="news" name="tags" value="news">
  <label for="news">News</label><br>
  <br>

  <!-- 选择Clan的id -->
  <label for="clanId">Select Clan ID:</label><br>
  <input type="text" id="clanSearch" oninput="filterClans()" placeholder="Search for Hero Name...">
  <select id="clanId" name="clanId">
    <option value="uncontrollableMoment" data-hero="uncontrollableMoment">funny-绷不住的瞬间</option>
    <option value="funnyCollection" data-hero="funnyCollection">funny-无敌合集</option>
    <option value="parodyAndPrank" data-hero="parodyAndPrank">funny-恶搞整活</option>
    <option value="superJoke" data-hero="superJoke">funny-超能段子</option>
    <option value="articles" data-hero="articles">最新资讯</option>
    {% for clan in clans %}
    <option value="{{ clan.id }}" data-hero="{{ clan.heroName }}">{{ clan.heroName }}</option>
    {% endfor %}
  </select><br><br>

  <input type="button" value="Save" onclick="saveData()">
</form>

<script>
  function filterClans() {
    var input, filter, select, options, option, i, heroName;
    input = document.getElementById("clanSearch");
    filter = input.value.toUpperCase();
    select = document.getElementById("clanId");
    options = select.getElementsByTagName("option");
    for (i = 0; i < options.length; i++) {
      option = options[i];
      heroName = option.getAttribute("data-hero").toUpperCase();
      if (heroName.indexOf(filter) > -1) {
        option.style.display = "";
      } else {
        option.style.display = "none";
      }
    }
  }

  function saveData() {
    var url = document.getElementById('url').value;
    var tags = Array.from(document.querySelectorAll('input[name="tags"]:checked')).map(tag => tag.value);
    var clanId = document.getElementById('clanId').value; // 获取选定的clanId值

    var data = {
      url: url,
      tags: tags,
      clanId: clanId // 将clanId值包含在请求数据中
    };

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/save_data', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          alert('Data saved successfully to backend!');
        } else {
          alert('Failed to save data to backend. Status code: ' + xhr.status);
        }
      }
    };
    xhr.send(JSON.stringify(data));
  }
</script>
</body>
</html>
