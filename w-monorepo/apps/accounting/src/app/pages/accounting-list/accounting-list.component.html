<div class="accounting-list">
  <div class="top-bar">
    <button class="add-button" [routerLink]="['/accounting/new']">
      â• æ–°å¢è®°å½•
    </button>

    <!-- âœ… æ–°å¢å¯¼å‡ºæŒ‰é’® -->
    <button class="export-button" (click)="openExportModal()">
      ğŸ“¥ å¯¼å‡ºè´¦å•
    </button>

    <!-- æœç´¢ç»„åˆ -->
    <div class="search-bar">
      <select [(ngModel)]="searchField">
        <option value="gameNames">æ¸¸æˆå</option>
        <option value="customerType">å®¢æˆ·ç±»å‹</option>
        <option value="platform">å¹³å°</option>
        <option value="remark">å¤‡æ³¨</option>
      </select>
      <input [(ngModel)]="searchKeyword" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®å­—" />
      <button (click)="search()">ğŸ” æœç´¢</button>
    </div>
  </div>

  <table class="record-table">
    <thead>
      <tr>
        <th>å•å·</th>
        <th>æ—¶é—´æ®µ</th>
        <th>æ—¶é•¿</th>
        <th>æœºå‹</th>
        <th>æ¸¸æˆå</th>
        <th>å®¢æˆ·ç±»å‹</th>
        <th>å›å¤´å®¢</th>
        <th>å®æ”¶é‡‘é¢</th>
        <th>å¤‡æ³¨</th>
        <th>å¹³å°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let record of pagedRecords">
        <td [title]="record.id">{{ record.id }}</td>
        <td [title]="formatTimeRange(record.startDateTime, record.endDateTime)">
          {{ formatTimeRange(record.startDateTime, record.endDateTime) }}
        </td>
        <td [title]="record.duration">{{ record.duration }}</td>
        <td [title]="record.consoleType">{{ record.consoleType }}</td>
        <td [title]="record.gameNames.join('; ')">
          {{ record.gameNames.join('; ') }}
        </td>
        <td [title]="record.customerType">{{ record.customerType }}</td>
        <td [title]="record.isReturning ? 'æ˜¯' : 'å¦'">
          {{ record.isReturning ? 'æ˜¯' : 'å¦' }}
        </td>
        <td [title]="record.actualAmount">{{ record.actualAmount }}</td>
        <td [title]="record.remark">{{ record.remark }}</td>
        <td [title]="record.platform">{{ record.platform }}</td>
        <td>
          <button [routerLink]="['/accounting/edit', record.id]">ç¼–è¾‘</button>
          <button (click)="delete(record.id)">åˆ é™¤</button>
          <button (click)="openReminderModal(record)">æé†’</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- åˆ†é¡µæ§ä»¶ + ç»Ÿè®¡ -->
  <div class="pagination">
    <button (click)="prevPage()" [disabled]="currentPage === 1">ä¸Šä¸€é¡µ</button>
    <span>ç¬¬ {{ currentPage }} é¡µ / å…± {{ totalPages }} é¡µ</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">
      ä¸‹ä¸€é¡µ
    </button>
    <span class="total-count">å…± {{ records.length }} æ¡æ•°æ®</span>
  </div>
</div>

<div class="reminder-modal" *ngIf="showReminder">
  <div class="reminder-wrapper">
    <div class="reminder-card" #reminderCard>
      <h3>å°Šæ•¬çš„ç©å®¶ï¼</h3>
      <p>æ¸¸æˆå¼€å§‹æ—¶é—´ï¼š{{ formatDate(reminderRecord?.startDateTime!) }}</p>
      <p>æ¸¸ç©æ—¶é•¿ï¼š{{ reminderRecord?.duration }} å°æ—¶</p>
      <p>
        ç»“æŸæ—¶é—´ï¼š<span class="end-date-time">{{
          formatDate(reminderRecord?.endDateTime!)
        }}</span>
      </p>
      <p class="greeting">é…·ä¹ä¹æ¸¸æˆï¼Œç¥æ‚¨æ¸¸æˆæ„‰å¿«ï¼</p>
    </div>

    <div class="buttons">
      <button (click)="closeReminderModal()">å…³é—­</button>
      <button (click)="exportReminderAsImage()">ç”Ÿæˆå›¾ç‰‡</button>
    </div>
  </div>
</div>

<!-- âœ… ç»Ÿä¸€å¯¼å‡ºå¼¹çª— -->
<div class="reminder-modal" *ngIf="showExportModal">
  <div class="reminder-wrapper">
    <div class="reminder-card">
      <h3>å¯¼å‡ºè´¦å•</h3>

      <p>
        <label
          ><input
            type="radio"
            name="exportMode"
            [(ngModel)]="exportMode"
            value="all"
          />
          å…¨éƒ¨å¯¼å‡º</label
        >
        <label style="margin-left: 16px"
          ><input
            type="radio"
            name="exportMode"
            [(ngModel)]="exportMode"
            value="range"
          />
          æŒ‰æ—¶é—´æ®µå¯¼å‡º</label
        >
      </p>

      <div *ngIf="exportMode === 'range'">
        <p>
          å¼€å§‹æ—¶é—´ï¼š
          <input type="datetime-local" [(ngModel)]="exportStartDateTime" />
        </p>
        <p>
          ç»“æŸæ—¶é—´ï¼š
          <input type="datetime-local" [(ngModel)]="exportEndDateTime" />
        </p>
      </div>

      <p>
        å¯¼å‡ºæ ¼å¼ï¼š
        <label>
          <input
            type="radio"
            name="exportFormat"
            [(ngModel)]="exportFormat"
            value="txt"
          />
          TXT
        </label>
        <label style="margin-left: 16px">
          <input
            type="radio"
            name="exportFormat"
            [(ngModel)]="exportFormat"
            value="excel"
          />
          Excel
        </label>
        <label style="margin-left: 16px">
          <input
            type="radio"
            name="exportFormat"
            [(ngModel)]="exportFormat"
            value="pdf"
          />
          PDF
        </label>
        <label style="margin-left: 16px">
          <input
            type="radio"
            name="exportFormat"
            [(ngModel)]="exportFormat"
            value="csv"
          />
          CSV
        </label>
      </p>

      <div class="buttons">
        <button (click)="closeExportModal()">å–æ¶ˆ</button>
        <button (click)="downloadExport()">å¯¼å‡º</button>
      </div>
    </div>
  </div>
</div>
