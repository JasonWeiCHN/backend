# WMonorepo

✨ **This workspace has been generated by [Nx, Smart Monorepos · Fast CI.](https://nx.dev)** ✨

## Integrate with editors

Enhance your Nx experience by installing [Nx Console](https://nx.dev/nx-console) for your favorite editor. Nx Console
provides an interactive UI to view your projects, run tasks, generate code, and more! Available for VSCode, IntelliJ and
comes with a LSP for Vim users.

## Start the application

Run `npx nx serve static` to start the development server. Happy coding!

## Build for production

Run `npx nx build static` to build the application. The build artifacts are stored in the output directory (e.g. `dist/` or `build/`), ready to be deployed.

## Running tasks

To execute tasks with Nx use the following syntax:

```
npx nx <target> <project> <...options>
```

You can also run multiple targets:

```
npx nx run-many -t <target1> <target2>
```

..or add `-p` to filter specific projects

```
npx nx run-many -t <target1> <target2> -p <proj1> <proj2>
```

Targets can be defined in the `package.json` or `projects.json`. Learn more [in the docs](https://nx.dev/features/run-tasks).

## Set up CI!

Nx comes with local caching already built-in (check your `nx.json`). On CI you might want to go a step further.

- [Set up remote caching](https://nx.dev/features/share-your-cache)
- [Set up task distribution across multiple machines](https://nx.dev/nx-cloud/features/distribute-task-execution)
- [Learn more how to setup CI](https://nx.dev/recipes/ci)

## Explore the project graph

Run `npx nx graph` to show the graph of the workspace.
It will show tasks that you can run with Nx.

- [Learn more about Exploring the Project Graph](https://nx.dev/core-features/explore-graph)

## Connect with us!

- [Join the community](https://nx.dev/community)
- [Subscribe to the Nx Youtube Channel](https://www.youtube.com/@nxdevtools)
- [Follow us on Twitter](https://twitter.com/nxdevtools)

## 设计

- 萌新上路 / 高手进阶 / 欢乐整活

## 开发日志

- id 维护
- 公共样式没有设计 可以extend的那种
- 列表滚动加载
- 页面数据采集
- 提交表单
- 缩略图 服务器

- [bug] tab 路由没有入 url 匹配

```
创建项目
npx nx g @nx/angular:app inventory --directory=apps/inventory --dry-run
npx nx g @nx/angular:app static-shogun --directory=apps/static-shogun --add-tailwind
npx nx g @nx/angular:app management-price-mobile --directory=apps/management-price-mobile --add-tailwind --standalone --style=scss
npx nx g @nx/angular:app accounting --directory=apps/accounting --add-tailwind --standalone --style=scss

创建lib
nx g @nx/angular:library products --directory=libs/products --standalone
nx g @nx/angular:lib constants --directory=libs/shared/constants --standalone

创建页面
nx g @nx/angular:component discount --directory=apps/static-warhammer3/src/app/pages/discount --standalone --style=scss --export

创建组件
nx g @nx/angular:component product-list --directory=libs/products/src/lib/product-list --standalone --export
nx g @nx/angular:component race-multiple-selector --directory=apps/static-warhammer3/src/app/components/race-multiple-selector --standalone --export --style=scss

在UI库创建组件
nx g @nx/angular:component article-card --directory=libs/shared/ui/src/lib/article-card --standalone --export --style=scss

给已有项目增加 tailwind
npx nx g @nx/angular:setup-tailwind my-project
```

## 数据导出 与 导入 postgre

### 导出

```
\! pg_dump -U postgres -h localhost -p 5432 -d jason -F c -b -v -f d:\jason.dump
```

### 导入

```
pg_restore -U postgres -h localhost -p 5432 -d jason d:\jason.dump
```

## 关于 bilibili-api 的使用

- 下载高清晰度视频 需要使用

```
streams = detecter.detect_all()

还要填写
SESSDATA = "6ee3c61d%2C1730955052%2C1cb77%2A51CjDAygcxInzoPR8iz_KWaluDNvEgadVmiP0PcIrTfaz2GNhA3zTRp0rjRXTRXB9IVm8SVmN6UV9VNFlYWDRER2pCYm9mZm5NUzBKdTFRMmN6b2RNUzB3UVR5U3B0eENKalZyTlFlNXpzZGZrN3doNkpwSV9nQXlIalRYVXFmei0xM1JpaVA0S0NBIIEC"
BILI_JCT = "7e5c5317fe9573a2c2d1d0817cccbd81"

然后再选择对应清晰度，注意 index
await download_url(streams[8].url, "video_temp.m4s", "视频流")
await download_url(streams[20].url, "audio_temp.m4s", "音频流")
```

- 没有清晰度要求的话 使用

```
streams = detecter.detect_best_streams()
```

## 服务器

```
用户名
ubuntu
P@ssw0rd

ssh ubuntu@111.230.29.99

检测你当前nginx配置是否正确
sudo nginx -t

编辑nginx配置
sudo nano /etc/nginx/sites-available/default

重启ngnix
sudo systemctl reload nginx

控制台测试
curl http://localhost

检查 Nginx 日志：
查看 Nginx 的错误日志文件，通常位于 /var/log/nginx/error.log。
这里会记录详细的错误信息，帮助您找到问题所在。

ubuntu 移动文件
sudo mv /home/ubuntu/wgy/browser /var/www

移动完成后，您可以使用 ls 命令检查目标目录中是否已经存在了 browser 目录及其内容：
ls /var/www

升级 pip
sudo pip install --upgrade pip

后台启动 python Flask 服务
nohup python3 statistics.py > flask.log &

添加新项目后 如果用了新端口
记得去服务器 在防火墙 添加规则
```

## 文件服务器

```
启动指令 定位到web-files
nohup python3 web.py > nohup.out 2>&1 &
```

- 如果文件服务出现问题，可以通过下面指令查看日志

```
cat nohup.out
```

- 文件服务启动在 5001 端口

```
ubuntu@VM-8-4-ubuntu:/var/www/web-files$ sudo lsof -i :5001
COMMAND   PID   USER   FD   TYPE    DEVICE SIZE/OFF NODE NAME
python3 26816 ubuntu    3u  IPv4 108410703      0t0  TCP *:5001 (LISTEN)
python3 26816 ubuntu    4u  IPv4 108412032      0t0  TCP VM-8-4-ubuntu:5001->219.134.234.132:32550 (CLOSE_WAIT)

上面的输出表示端口 5001 正在被进程 26816 占用。
可以通过下面操作结束进程
sudo kill -9 26816

检查端口是否仍被占用
sudo lsof -i :5001

重新运行启动脚本
nohup python3 web.py > nohup.out 2>&1 &
```

### 价格上传服务

```
cd /var/www/management-price-mobile/assets/
nohup python3 server.py > flask_app.log 2>&1 &
```

## 用户轨迹记录

- 翻墙访问会跨域 无法记录轨迹
- 翻墙访问是可以打开网站的 但是无法请求接口

## 配置投票服务

- 安装 Flask Flask-CORS pymongo

```
python3 -m pip install Flask Flask-CORS pymongo
```

- 安装 mongodb

```
sudo apt update
sudo apt install mongodb
sudo systemctl start mongodb
```

- 查询线上mongodb数据

```
连接到 MongoDB 数据库：
mongo

选择数据库：
use <database_name>

执行查询：
db.<collection_name>.find()
```

- 重启mongodb的指令

```
sudo systemctl restart mongodb
```

- 后台启动 vote.py

```
nohup python3 vote.py &
```

- 查看 vote.py 进程

```
ps aux | grep vote.py
```

## 重启服务器的悲剧

```
投票系统重启
cd /var/www/vote/
nohup python3 vote.py &

统计系统重启
cd /var/www/statistics/
nohup python3 statistics.py > flask.log &

文件系统重启
cd /var/www/web-files/
nohup python3 web.py > nohup.out 2>&1 &
```

## 酷乐乐后台运行指令

```
cd /var/www/
nohup python3 server.py > ~/server.log 2>&1 &
```

## 实用指令

```
找出所有监听 4011 的配置:
grep -rn "4011" /etc/nginx/
```

## Nginx 服务器 配置 SSL

```
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # SSL configuration
        listen 443 ssl;
        server_name pet6688.com;
        ssl_certificate /etc/nginx/ssl/pet6688.com_bundle.crt;
        ssl_certificate_key /etc/nginx/ssl/pet6688.com.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
        ssl_prefer_server_ciphers on;
```
